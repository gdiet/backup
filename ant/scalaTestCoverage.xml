<?xml version="1.0" encoding="UTF-8"?>

<project name="scalaTestCoverage" default="cover" basedir="../">

  <taskdef resource="org/jacoco/ant/antlib.xml" classpath="lib/test/jacocoant.jar" uri="antlib:org.jacoco.ant" />
  <property environment="env"/>
  
  <target name="cover" xmlns:jacoco="antlib:org.jacoco.ant">
    <echo message="using scala from ${env.SCALA_HOME}"/>
    <delete dir="test-output" />
    
    <jacoco:coverage destfile="test-output/jacoco.exec">
      <java classname="org.scalatest.tools.Runner" fork="true">
		<arg line="-R bin -oW"/>
        <classpath>
          <pathelement path="bin" />
          <pathelement path="lib/h2-1.3.170.jar" />
          <pathelement path="lib/test/scalatest_2.10-1.9.1.jar" />
          <pathelement location="${env.SCALA_HOME}/lib/*" />
        </classpath>
      </java>
    </jacoco:coverage>
    
    <jacoco:report>
      <executiondata>
        <file file="test-output/jacoco.exec"/>
      </executiondata>
      <structure name="Coverage">
        <classfiles>
          <fileset dir="bin/net/diet_rich" />
        </classfiles>
        <sourcefiles encoding="UTF-8">
          <fileset dir="src"/>
        </sourcefiles>
      </structure>
      <html destdir="test-output/jacoco"/>
    </jacoco:report>    

  </target>
</project>