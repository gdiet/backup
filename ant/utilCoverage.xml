<?xml version="1.0" encoding="UTF-8"?>

<project name="utilCoverage" default="cover" basedir="../">

  <taskdef resource="testngtasks" classpath="lib/test/testng/testng-6.5.2.jar" />
  <taskdef resource="org/jacoco/ant/antlib.xml" classpath="lib/test/jacoco/jacocoant.jar" uri="antlib:org.jacoco.ant" />
  <property environment="env"/>
  
  <target name="cover" xmlns:jacoco="antlib:org.jacoco.ant">
    <echo message="using scala from ${env.SCALA_HOME}"/>
    <delete dir="test-output" />
    
    <jacoco:coverage destfile="test-output/jacoco.exec">
      <testng haltonfailure="true" outputdir="test-output/testng">
        <classpath>
          <pathelement path="bin" />
          <pathelement path="lib/sql/h2-1.3.163.jar" />
          <pathelement path="lib/sql/hsqldb.jar" />
          <pathelement path="lib/test/fest/fest-assert-1.4.jar;lib/test/fest/fest-util-1.1.6.jar" />
          <pathelement path="lib/test/apacheCommons/commons-io-2.1.jar" />
          <pathelement path="${env.SCALA_HOME}/lib/scala-library.jar" />
        </classpath>
        <xmlfileset dir="ant" includes="utilTests.xml"/>
      </testng>
    </jacoco:coverage>
    
    <jacoco:report>
      <executiondata>
        <file file="test-output/jacoco.exec"/>
      </executiondata>
      <structure name="Coverage">
        <classfiles>
          <fileset dir="bin/net/diet_rich/util" />
        </classfiles>
        <sourcefiles encoding="UTF-8">
          <fileset dir="src"/>
        </sourcefiles>
      </structure>
      <html destdir="test-output/jacoco"/>
    </jacoco:report>    

  </target>
</project>